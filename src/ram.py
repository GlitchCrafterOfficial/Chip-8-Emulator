import numpy as np
from src.singleton import SingletonMeta


class RAM(metaclass=SingletonMeta):
    def __init__(self):
        self.ram = np.zeros((4096,), dtype=int).tolist()
        self.__load_sprites()

    def __load_sprites(self):
        self.ram[0:5] = 0xF0, 0x90, 0x90, 0x90, 0xf0   # 0
        self.ram[5:10] = 0x20, 0x60, 0x20, 0x20, 0x70  # 1
        self.ram[10:15] = 0xF0, 0x10, 0xF0, 0x80, 0xF0 # 2
        self.ram[15:20] = 0xF0, 0x10, 0xF0, 0x10, 0xF0 # 3
        self.ram[20:25] = 0x90, 0x90, 0xF0, 0x10, 0x10 # 4
        self.ram[25:30] = 0xF0, 0x80, 0xF0, 0x10, 0xF0 # 5
        self.ram[30:35] = 0xF0, 0x80, 0xF0, 0x90, 0xF0 # 6
        self.ram[35:40] = 0xF0, 0x10, 0x20, 0x40, 0x40 # 7
        self.ram[40:45] = 0xF0, 0x90, 0xF0, 0x90, 0xF0 # 8
        self.ram[45:50] = 0xF0, 0x90, 0xF0, 0x10, 0xF0 # 9
        self.ram[50:55] = 0xF0, 0x90, 0xF0, 0x90, 0x90 # A
        self.ram[55:60] = 0xE0, 0x90, 0xE0, 0x90, 0xE0 # B 
        self.ram[60:65] = 0xF0, 0x80, 0x80, 0x80, 0xF0 # C 
        self.ram[65:70] = 0xE0, 0x90, 0x90, 0x90, 0xE0 # D
        self.ram[70:75] = 0xF0, 0x80, 0xF0, 0x80, 0xF0 # E
        self.ram[75:80] = 0xF0, 0x80, 0xF0, 0x80, 0x80 # F

    def load_program(self, path):
        with open(path, 'rb') as f:
            program = [x for x in f.read()]
        program = np.array(program)
        self.ram[0x200:0x200+len(program)] = program

    def __getitem__(self, key):
        return self.ram[key]

    def __setitem__(self, key, value):
        self.ram[key] = value